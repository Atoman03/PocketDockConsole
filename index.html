<!DOCTYPE HTML>

<html>

    <head>
        <title>PocketDockConsole</title>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="//cdn.rawgit.com/chjj/term.js/0b10f6c55d5113d50d0ff94b6c38a46375a5f9a5/src/term.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <style>
            body {
                background: #000;
                font-size: 15px;
                font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;
                color: #99CCFF;
            }
            #term-startline {
                color: #f0f0f0;
            }
            #getInfo {
                background: #fff;
                color: #000;
            }
        </style>
    </head>

    <script type="text/javascript">
        $(function() {
            $('#getInfo').modal({
                show: true
            });
        });

        function doStuff() {
            socket = new WebSocket("ws://" + $("#ip").val() + ":" + $("#port").val());
            socket.onopen = function(evt) {
                term = new Terminal({
                    cols: 120,
                    rows: 25,
                    screenKeys: true
                });

                term.on("data", function(data) {
                    var firstText = $('#term-startline').text();
                    if (data == "\x7f") {
                        $('#term-startline').text(firstText.substr(0, firstText.length - 1));
                    } else if (data == "\r") {
                        socket.send(firstText + data);
                        $('#term-startline').text("");
                        if (firstText == "stop") {
                            term.destroy();
                            $("#term-title").text("Session Terminated");
                        }
                    } else {
                        $('#term-startline').text(firstText + data);
                    }
                });

                term.on("title", function(title) {
                    $("#term-title").text(title);
                });

                term.open(document.getElementById("container-terminal"));

                socket.onmessage = function(msg) {
                    term.write(msg.data);
                };

                socket.onclose = function(msg) {
                    $("#term-title").text("Session Terminated");
                };
            };

            socket.onerror = function(data) {
                alert("Unable to connect to server, please follow the install guide and ensure the server is running");
            }
        }
    </script>

    <body>
        <div id="all">
            <div id="container-terminal">
                <div id="term-title"></div>
            </div>
            <div id="term-startline"></div>
        </div>
    </body>

    <div class="modal fade" id="getInfo">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <h4 class="modal-title">Server Connection Information</h4>
                </div>
                <div class="modal-body">
                    Server IP:
                    <input type="text" name="ip" id="ip">
                    <br>Server Port:
                    <input type="text" name="port" id="port">
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-primary" id="doStuff" data-dismiss="modal" aria-hidden="true" onclick="doStuff();">Connect to console!</a>
                </div>
            </div>
        </div>
    </div>

</html>
